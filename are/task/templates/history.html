<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>{{ search['title'] }} {{ search['owner'] }} {{ search['tag'] }} ã‚¿ã‚¹ã‚¯</title>
    <style type="text/css">
		* { font-size  : 1em;	line-height:1;}
		body { margin  : 1px;	}
		p { margin  : 5px;	}
		section h1 { margin-bottom  : 0px;	}
		footer { margin-top  : 3em;	}
    </style>
</head>
<body>

<h1><a href="{{ url_for('task.index') }}">ã‚¿ã‚¹ã‚¯</a> <a href="{{ url_for('task.history') }}">å±¥æ­´</a>
    <select name="select" onChange="location.href=value;">
        <option value="{{ url_for('task.history', change='status', to='', **search) }}">å…¨çŠ¶æ…‹</option>
      {%- if search['status'][0] == '-' -%}
        <option value="" selected>{{search['status']}}</option>
      {%- endif %}
        <option value="{{ url_for('task.history', change='status', to='å®Œ', **search) }}"{% if search['status'] == "å®Œ" %} selected{% endif %}>å®Œ</option>
        <option value="{{ url_for('task.history', change='status', to='å´ä¸‹', **search) }}"{% if search['status'] == "å´ä¸‹" %} selected{% endif %}>å´ä¸‹</option>
    </select>
    <select name="select" onChange="location.href=value;">
        <option value="{{ url_for('task.history', change='sort', to='time', **search) }}"{% if search['sort'] == "time" %} selected{% endif %}>æ—¥æ™‚é †</option>
        <option value="{{ url_for('task.history', change='sort', to='', **search) }}">é‡è¦åº¦é †(æœªå®Ÿè£…)</option>
        <option value="{{ url_for('task.history', change='sort', to='cost', **search) }}"{% if search['sort'] == "cost" %} selected{% endif %}>ãƒã‚¤ãƒ³ãƒˆé †</option>
        <option value="{{ url_for('task.history', change='sort', to='title', **search) }}"{% if search['sort'] == "title" %} selected{% endif %}>ã‚¿ã‚¹ã‚¯åé †</option>
    </select>
    <select name="select" onChange="location.href=value;">
        <option value="{{ url_for('task.history', change='cycle', to='', **search) }}">å…¨ç¨®</option>
        <option value="{{ url_for('task.history', change='cycle', to='none', **search) }}"{% if search['cycle'] == "none" %} selected{% endif %}>å˜ç™º</option>
        <option value="{{ url_for('task.history', change='cycle', to='routine', **search) }}"{% if search['cycle'] == "routine" %} selected{% endif %}>å®šæœŸ</option>
        <option value="{{ url_for('task.history', change='cycle', to='randomly', **search) }}"{% if search['cycle'] == "randomly" %} selected{% endif %}>ä¸å®š</option>
    </select>

  {%- if search['owner'] %}
    {{ search['owner'] }}
  {%- endif -%}

  {%- if search['tag1st'] %}
    {{ search['tag1st'] }}
  {%- endif -%}

  {%- if search['cost'] %}
    {{ search['cost'] }}p
  {%- endif -%}

  {%- if search['tag'] %}
    {{ search['tag'] }}
  {%- endif -%}
</h1>

<nav>

    <select name="select" onChange="location.href=value;">
        <option value="#">ã¯ã˜ã‚ã«</option>
        <option value="{{ url_for('task.history', tag='æ—¥ åˆ') }}">æ—¥åˆ</option>
        <option value="{{ url_for('task.history', tag='é€± åˆ') }}">é€±åˆ</option>
        <option value="{{ url_for('task.history', tag='æœˆ åˆ') }}">æœˆåˆ</option>
        <option value="{{ url_for('task.history', tag='å¹´ åˆ') }}">å¹´åˆ</option>
        <option value="#">ãƒ¼ãƒ¼ãƒ¼ãƒ¼</option>
        <option value="{{ url_for('task.history', tag='è€ƒ -æ—¥') }}">è€ƒ</option>
        <option value="{{ url_for('task.history', tag='æš® -æ—¥') }}">æš®</option>
        <option value="{{ url_for('task.history', tag='ç’° -æ—¥') }}">ç’°</option>
        <option value="{{ url_for('task.history', tag='ï½±ï¾š') }}">ï½±ï¾š</option>
        <option value="#">ãƒ¼ãƒ¼ãƒ¼ãƒ¼</option>
        <option value="{{ url_for('task.history', tag='æ—¥ æœ«') }}">æ—¥æœ«</option>
        <option value="{{ url_for('task.history', notag='') }}">æœªåˆ†é¡</option>
        <option value="{{ url_for('task.history', rate='0only') }}">æœªè¦åº¦</option>
        <option value="{{ url_for('task.history', cost='0') }}">æœªè¦‹ç©</option>
        <option value="{{ url_for('task.history', cost='1', cycle='none', owner='-è²·', tag='-è²·' , rate='3over') }}">ã™ãã‚„ã‚‹</option>
    </select>

    <select name="select" onChange="location.href=value;">
        <option value="#">ã‚ˆãä½¿ã†</option>
        <option value="{{ url_for('task.history', tag='æ—¥ -åˆ -æœ« -é£Ÿ -å¯ -çŒ« -ï½±ï¾š' ) }}">æ—¥</option>
        <option value="{{ url_for('task.history', tag='é€± -åˆ -æœ«') }}">é€±</option>
        <option value="{{ url_for('task.history', tag='æœˆ -åˆ -æœ«') }}">æœˆ</option>
        <option value="{{ url_for('task.history', tag='å¹´ -åˆ -æœ«') }}">å¹´</option>
        <option value="{{ url_for('task.history', cycle='routine', tag='-æ—¥ -é€± -æœˆ -å¹´') }}">ä»–å®šæœŸ</option>
        <option value="{{ url_for('task.history', cycle='randomly') }}">ç¹°ã‚Šè¿”ã—</option>
        <option value="{{ url_for('task.history', cycle='none') }}">å˜ç™º</option>
        <option value="{{ url_for('task.history', tag='å‡¦ç†å¾…ç®±') }}">å‡¦ç†å¾…ç®±</option>
        <option value="#">ãƒ¼ãƒ¼ãƒ¼ãƒ¼</option>
        <option value="{{ url_for('task.history', tag='çŒ«' ) }}">çŒ«</option>
        <option value="{{ url_for('task.history', tag='é£Ÿ' ) }}">é£Ÿ</option>
        <option value="{{ url_for('task.history', tag='å°æ‰€') }}">å°æ‰€</option>
        <option value="{{ url_for('task.history', tag='é¢¨å‘‚') }}">é¢¨å‘‚</option>
        <option value="{{ url_for('task.history', tag='å¯' ) }}">å¯</option>
        <option value="{{ url_for('task.history', tag='èµ·åºŠå¾Œ' ) }}">èµ·åºŠå¾Œ</option>
        <option value="{{ url_for('task.history', tag='å¤•' ) }}">å¤•</option>
        <option value="{{ url_for('task.history', tag='èµ·åºŠå¾Œ' ) }}">å°±å¯å‰</option>
    </select>
    <select name="select" onChange="location.href=value;">
        <option value="#">ä»–</option>
        <option value="{{ url_for('task.history', tag='è²·') }}">è²·</option>
        <option value="{{ url_for('task.history', tag='å¨¯') }}">å¨¯</option>
        <option value="{{ url_for('task.history', tag='èª¿') }}">èª¿</option>
        <option value="{{ url_for('task.history', tag='ä½œ') }}">ä½œ</option>
    </select>


    <a href="{{ url_for('task.çµ±è¨ˆ') }}">çµ±è¨ˆ</a>

    <br>

  {% if search['status'] %}
    {%- if search['status'][0] != '-' -%}{%- set vst=search['status'] -%}{%- else -%}{%- set vst=search['status'][1:] -%}{%- endif %}
    <select name="select" onChange="location.href=value;">
        <option value="#">{{search['status']}}</option>
      {%- if search['status'][0] != '-' -%}
        <option value="{{ url_for('task.history', change='status', to='-{}'.format(vst), **search) }}">é™¤å¤–</option>
      {%- else -%}
        <option value="{{ url_for('task.history', change='status', to=vst, **search) }}">è¡¨ç¤º</option>
      {%- endif %}
        <option value="{{ url_for('task.history', change='status', to='', **search) }}">è§£é™¤</option>
    </select>
  {% endif %}
  {% if search['rate'] == "1only" -%}
    <a href="{{ url_for('task.history', change='rate', to='', **search) }}">â˜…</a>
  {%- else -%}
    <a href="{{ url_for('task.history', change='rate', to='1only', **search) }}">
      {%- if not "only" in search['rate'] and search['rate'] | int >= 1 %}â˜…{% else %}â˜†{% endif -%}
    </a>
  {%- endif -%}
  {%- if search['rate'] == "2only" -%}
    <a href="{{ url_for('task.history', change='rate', to='2', **search) }}">â˜…</a>
  {%- elif search['rate'] == "2" -%}
    <a href="{{ url_for('task.history', change='rate', to='', **search) }}">â˜…</a>
  {%- else -%}
    <a href="{{ url_for('task.history', change='rate', to='2only', **search) }}">
      {%- if not "only" in search['rate'] and search['rate'] | int >= 2 %}â˜…{% else %}â˜†{% endif -%}
    </a>
  {%- endif -%}
  {%- if search['rate'] == "3only" -%}
    <a href="{{ url_for('task.history', change='rate', to='3', **search) }}">â˜…</a>
  {%- elif search['rate'] == "3" -%}
    <a href="{{ url_for('task.history', change='rate', to='', **search) }}">â˜…</a>
  {%- else -%}
    <a href="{{ url_for('task.history', change='rate', to='3only', **search) }}">
      {%- if not "only" in search['rate'] and search['rate'] | int >= 3 %}â˜…{% else %}â˜†{% endif -%}
    </a>
  {%- endif -%}
  {%- if search['rate'] == "4only" -%}
    <a href="{{ url_for('task.history', change='rate', to='4', **search) }}">â˜…</a>
  {%- elif search['rate'] == "4" -%}
    <a href="{{ url_for('task.history', change='rate', to='', **search) }}">â˜…</a>
  {%- else -%}
    <a href="{{ url_for('task.history', change='rate', to='4only', **search) }}">
      {%- if not "only" in search['rate'] and search['rate'] | int >= 4 %}â˜…{% else %}â˜†{% endif -%}
    </a>
  {%- endif -%}
  {%- if search['rate'] == "5only" -%}
    <a href="{{ url_for('task.history', change='rate', to='5', **search) }}">â˜…</a>
  {%- elif search['rate'] == "5" -%}
    <a href="{{ url_for('task.history', change='rate', to='', **search) }}">â˜…</a>
  {%- else -%}
    <a href="{{ url_for('task.history', change='rate', to='5only', **search) }}">
      {%- if not "only" in search['rate'] and search['rate'] | int >= 5 %}â˜…{% else %}â˜†{% endif -%}
    </a>
  {%- endif %}

  {%- if search['cost'] %}
    <a href="{{ url_for('task.history', change='cost', to='', **search) }}">{{ search['cost'] }}p</a>
  {%- endif %}
  {%- if search['owner'] %}
    <a href="{{ url_for('task.history', change='owner', to='', **search) }}">{{ search['owner'] }}</a>
  {%- endif %}
  {%- if search['tag1st'] %}
    <a href="{{ url_for('task.history', change='tag1st', to='', **search) }}">{{ search['tag1st'] }}</a>
  {%- endif %}
  {%- if search['tag'] -%}
    {%- set tagall=search['tag'].split() -%}
    {%- for tag in tagall %}
      {%- if tag[0] != '-' -%}{%- set vtag=tag -%}{%- else -%}{%- set vtag=tag[1:] -%}{%- endif %}
      <select name="select" onChange="location.href=value;">
          <option value="#">{{ tag }}</option>
          {%- if tag[0] != '-' -%}
          <option value="{{ url_for('task.history', hidetag=vtag, **search) }}">é™¤å¤–</option>
          {%- else -%}
          <option value="{{ url_for('task.history', showtag=vtag, **search) }}">è¡¨ç¤º</option>
          {%- endif %}
          <option value="{{ url_for('task.history', deltag=tag, **search) }}">è§£é™¤</option>
          <option value="{{ url_for('task.history', change='tag', to=vtag, **search) }}">ã®ã¿</option>
      </select>
    {%- endfor %}
  {%- endif %}
  {%- if search['title'] %}
    <a href="{{ url_for('task.history', change='title', to='', **search) }}">{{ search['title'] }}</a>
  {%- endif %}
</nav>

<article>
  {% for key, value in tasks.items() %}
    <section>
        <h1><a href="{{ url_for('task.history', change='status', to=key , **search) }}">{{ key }}</a></h1>
      {% for task in value %}
        <div style="4px 0px 0px 0px;padding:4px 0px 0px 0px;">
          <div style="border-style: solid none none solid; border-width: 1px; margin:0px 4px 0px 0px">
          {% if task['å®Œäº†æ—¥æ™‚'] %}
            <span style="font-size  : 0.5em;">{{ task['utcP9time']}}</span>
            [<a href="{{ url_for('task.archivecostup', number=task['ä¿å­˜ç•ªå·'], **search) }}">{{ task['å®Ÿç¸¾å€¤'] }}</a>/{{ task['äºˆæ¸¬å€¤'] }}]
          {% else %}
            {% if task['é‡è¦åº¦'] == 1 -%}
              <a href="{{ url_for('task.archiverateto', number=task['ä¿å­˜ç•ªå·'], change=0, **search) }}">â˜…</a>
            {%- else -%}
              <a href="{{ url_for('task.archiverateto', number=task['ä¿å­˜ç•ªå·'], change=1, **search) }}">
              {%- if task['é‡è¦åº¦'] > 0 %}â˜…{% else %}â˜†{% endif -%}
              </a>
            {%- endif -%}
              <a href="{{ url_for('task.archiverateto', number=task['ä¿å­˜ç•ªå·'], change=2, **search) }}">
                {%- if task['é‡è¦åº¦'] > 1 %}â˜…{% else %}â˜†{% endif -%}
              </a><a href="{{ url_for('task.archiverateto', number=task['ä¿å­˜ç•ªå·'], change=3, **search) }}">
                {%- if task['é‡è¦åº¦'] > 2%}â˜…{% else %}â˜†{% endif -%}
              </a><a href="{{ url_for('task.archiverateto', number=task['ä¿å­˜ç•ªå·'], change=4, **search) }}">
                {%- if task['é‡è¦åº¦'] > 3 %}â˜…{% else %}â˜†{% endif -%}
              </a><a href="{{ url_for('task.archiverateto', number=task['ä¿å­˜ç•ªå·'], change=5, **search) }}">
                {%- if task['é‡è¦åº¦'] > 4 %}â˜…{% else %}â˜†{% endif -%}
              </a>
              <a href="{{ url_for('task.archivecostup', number=task['ä¿å­˜ç•ªå·'], **search) }}">{{ task['äºˆæ¸¬å€¤'] }}</a>
          {%- endif %}
            :
            {% if task['å‚™è€ƒ'] %} â€» {% endif %}
          {% for tag in tags[task['ä¿å­˜ç•ªå·']] %}
            <a href="{{ url_for('task.history', addtag=tag, **search) }}" >{{ tag }}</a>
          {% endfor %}
          </div>
          <div style="margin : 1px; ">
            {% if tags[task['ä¿å­˜ç•ªå·']][0] and search['tag1st'] == '' %}
              <a href="{{ url_for('task.history', change='tag1st',to=tags[task['ä¿å­˜ç•ªå·']][0] , **search) }}" >{{ tags[task['ä¿å­˜ç•ªå·']][0] }}</a>
            {%- endif %}
            {{ task['ã‚¿ã‚¹ã‚¯å'] }}
            <a style="font-size  : 0.8em;" href="{{ url_for('task.archiveupdate', number=task['ä¿å­˜ç•ªå·'], **search) }}">ğŸ“</a>
          </div>
        </div>
      {% endfor %}
    </section>
  {% endfor %}
</article>


<footer>
    <form action="{{ url_for('task.history',site=site) }}" method="GET">
        <input id="search" class="text" type="text" value="{{ search['title'] }}" name="title">
        <input class="submitbutton" type="submit" value="æ¤œç´¢">
    </form>
  {% if g.user %}
    <span>{{ g.user['username'] }}</span>
    <a href="{{ url_for('auth.logout') }}">Log Out</a>
  {% else %}
    <a href="{{ url_for('auth.register') }}">Register</a>
    <a href="{{ url_for('auth.login') }}">Log In</a>
  {% endif %}
</footer>

</body>
</html>